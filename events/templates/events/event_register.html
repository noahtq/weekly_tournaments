{% extends "events/base.html" %}
{% load static %}
{% block content %}
    <div class="form-container form-container-event-register">
        <div class="input-form">
            <div class="event-register-info">
                <legend>Register for {{ event.title }}</legend>
                <p class="small center">To register for tournament, make the payment through paypal, navigate back to this page, and click the register button.</p>
            </div>
            {% if registered == False %}
                <div id="paypal-button-container"></div>

                <div class="status-icon">
                    <img id="checkmark" src="{% static 'events/icons/status/checkmark_001.png' %}" alt="">
                </div>
                <form method="POST">
                    {% csrf_token %}
                    <div class="button-container">
                        <span class="btn-deactivated">Register</span>
                        <button class="btn btn-info" type="submit" style="display: none">Register</button>
                    </div>
                </form>
            {% else %}
                <h3>You are already registered for {{event.title}}.</h3>
                <a class="center" href="{% url 'events-home' %}">Go to Home</a>
            {% endif %}
        </div>
        <div class="form-sidepanel">
            <img src="{% static 'events/images/background/dunking_outside_001.jpg' %}" alt="">
        </div>
    </div>

    <script src="https://www.paypal.com/sdk/js?client-id={{ client_id }}&currency=USD&disable-funding=credit"></script>

    <script event_price="{{ event.price }}">
        
        const eventPrice = document.currentScript.getAttribute('event_price');
        console.log(eventPrice);

        const statusIcon = document.getElementById('checkmark');
        const payButton = document.getElementsByClassName('btn-info')[0];
        const deactivatedButton = document.getElementsByClassName('btn-deactivated')[0];

        // Render the PayPal button into #paypal-button-container
        paypal.Buttons({

            style: {
                color:  'blue',
                shape:  'rect',
                label:  'pay',
                height: 40
            },

            //Create transaction
            createOrder: function(data, actions) {
                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: '25.00'
                        }
                    }]
                });
            },

            //Finalize transaction
            onApprove: function(data, actions) {
                return actions.order.capture().then(function(details)
                    {
                        statusIcon.style.opacity = '1';
                        deactivatedButton.style.display = 'none';
                        payButton.style.display = 'block';
                    });
            }

        }).render('#paypal-button-container');
    </script>

{% endblock content %}